{% extends "base.html" %}
{% set title = "Admin Login" %}

{% block content %}
<div class="login-container">
  <h2>ðŸ”’ Admin Login</h2>
  <div id="message"></div>

  <form id="login-form" class="form">
    <div class="form-group">
      <label>Username</label>
      <input id="username" type="text" autocomplete="username" placeholder="">
    </div>

    <div class="form-group">
      <label>Password</label>
      <input id="password" type="password" placeholder="If you forgot, call tech support" required autocomplete="current-password" autofocus>
    </div>

    <button class="btn" type="submit" style="width:100%;">Login</button>
  </form>

  <div class="hint">
    <div><b>New login:</b> new accounts cannot be created</div>
    <div style="margin-top:6px;">If you need tech support, you are out of luck.</div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showError(text){
  document.getElementById("message").innerHTML = `<div class="message message-error">${text}</div>`;
}

document.getElementById("login-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;

  // If username is blank, use legacy mode (password-only)
  const payload = username ? { username, password } : { password };

  const res = await fetch("/admin/login", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  if (res.ok) {
    window.location.href = "/admin/inventory";
    return;
  }

  const data = await res.json().catch(() => ({}));
  showError(data.error || data.message || "Login failed");
});
</script>
{% endblock %}
